# 现代操作系统：原理与实现

## 操作系统概述

### 什么是操作系统

操作系统有两个职责:对硬件进行管理和抽象，为应用提供服务并进行管理。

从硬件的角度看，操作系统主要包含两类共性功能：一是管理硬件，二是对硬件进行抽象。一方面，操作系统将复杂的、具备不同功能的硬件资源纳入统—的管理。另一方面，操作系统负责将硬件抽象成不依赖具体硬件特性的资源。在这个过中，操作系统的核心功能是将有限的、离散的资源高效地抽象为无限的、连续的资源，并将硬件通过易用的接口提供给上层的应用，从而使应用无须关心硬件的具体细节。

从应用的角度来看，操作系统主要包含两类共性功能：一是服务于应用（提供接口），二是管理应用（应用的加载、启动、切换、调度销毁等）。

通常而言，狭义的操作系统指的是操作系统内核加上—个Shell。广义的操作系统又可以进一步分为操作系统内核与操作系
统框架两层。

![2022-08-05 09-43-03 的屏幕截图](/home/cccmmf/操作系统/现代操作系统：原理与实现/chap1操作系统概述/2022-08-05 09-43-03 的屏幕截图.png)

左侧图展示了操作系统内核负责对硬件资源的管理与抽象，为操作系统框架提供基础的系统服务；操作系统框架则基于操作系统内核提供的服务为不同的应用领域提供编程接口与运行环境。右侧展示了Android操作系统的结构：Linux内核提供对硬件的抽象与管理，由应用框架、系统库、应用编程环境等组成的Android系统框架对上层提供Android应用的开发与执行环境。

### 操作系统简史

#### GM-NAA I/O：第一个（批处理）操作系统

1946年2月14日,世界上公认的第一台通用计算机ENIAC在美国宾夕法尼亚大学诞生。

1956年，RobertL.Patrick和Owen Mock在IBM 704上实现了第—个公认的操作系统GM-NAA I/O，即通用汽车公司和北美航空的输入／输出系统（General Motors and North American Aviation Input/Output system）。GM-NAA I/O实现的就是
批处理（batchprocessing）。具备批处理特性的一系列操作系统也被称为批处理操作系统。

### 操作系统接口

#### 系统调用接口

应用程序通过操作系统内核提供的接口（例如系统调用）向内核申请服务。首先，printf调用标准库libc中的write函数。libc在准备好相关参数后，指向svc指令使得控制流从用户地址空间下限到内核地址空间。操作系统内核的下陷处理函数根据系统调用传入的第一个参数，识别出该调用需要执行操作系统内核提供的sys_write函数，从而通过系统调用表调用对应函数。

svc指令是一条ARM指令，表示特权调用。

![2022-08-05 10-08-43 的屏幕截图](/home/cccmmf/操作系统/现代操作系统：原理与实现/chap1操作系统概述/2022-08-05 10-08-43 的屏幕截图.png)

#### Chcroe：一个简单的实验操作系统

ChCore是用于本书教学而开发的实验操作系统。其基本架构如图所示。ChCore采用了微内核架构（见第3章）的设计理念，将大部分的操作系统功能以系统服务的形式运行在用户态，这与以Linux和Windows为代表的宏内核操作系统形成鲜明对比。在Linux或Windows中，文件系统通常作为操作系统内核的一部分直接运行在内核态；然而在ChCore中，文件系统不再属于内核的一部分，而是作为一个系统服务运行在用户态，实际上是一个独立的用户态进程。当一个应用程序需要使用文件系统功能时，它将在ChCore微内核的帮助下与文件系统进行通信。从而获得所需服务。这种设计的一个优势是，文件系统的崩溃问题或安全漏洞很难影响到操作系统的其他功能组件，如内存管理、设备驱动等；同样，其他功能组件的问题也很难影响到文件系统的运行，从而显著提升了操作系统的安全性与可靠性。

因此。在拥有特权的内核态，ChCore仅运行很少的代码。这部分代码只负责最基础的职责与功能，主要包括以下部分:内存管理、调度器、进程间通信、权限管理。

总而言之，ChCore实验操作系统包括两个部分：运行在内核态的ChCore微内核和运行在用户态的各种操作系统服务。

![2022-08-05 10-16-08 的屏幕截图](/home/cccmmf/操作系统/现代操作系统：原理与实现/chap1操作系统概述/2022-08-05 10-16-08 的屏幕截图.png)

















